<html data-namespace-typo3-fluid="true" lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      xmlns:msh="http://typo3.org/ns/Mindshape/MindshapeSeo/ViewHelpers"
      xmlns:f="http://typo3.org/ns/fluid/ViewHelpers">

    <f:layout name="Backend"/>

    <f:section name="Main">

        <f:if condition="{noPageSelected}">
            <f:then>
                <f:translate key="tx_mindshapeseo_label.preview.no_page_selected"/>
            </f:then>
            <f:else>
                <div class="mindshapeseo-preview">
                    <f:render section="Preview" arguments="{_all}"/>
                </div>
            </f:else>
        </f:if>

    </f:section>

    <f:section name="Preview">

        <h1>
            <f:translate key="tx_mindshapeseo_label.seo_preview_for_page"/>
            {currentPageMetaData.title}
        </h1>

        <div class="row">
            <div class="col-sm-2">
                <f:form id="depthselect-form" action="preview" controller="Backend">
                    <div class="form-group">
                        <label>
                            <f:translate key="tx_mindshapeseo_label.preview.levels"/>
                        </label>
                        <f:form.select id="depthselect" name="depth" options="{levelOptions}" value="{depth}" class="form-control"/>
                    </div>
                </f:form>
            </div>
        </div>

        <f:if condition="{settings.pageTree.usePagination}">
            <f:then>
                <msh:widget.paginate objects="{pageTree}" as="paginatedPages">
                    <f:render section="PageTreeTable" arguments="{pageTree: paginatedPages, titleAttachment: titleAttachment, titleAttachmentSeperator: titleAttachmentSeperator, titleAttachmentPosition: titleAttachmentPosition}"/>
                </msh:widget.paginate>
            </f:then>
            <f:else>
                <f:render section="PageTreeTable" arguments="{pageTree: pageTree, titleAttachment: titleAttachment, titleAttachmentSeperator: titleAttachmentSeperator, titleAttachmentPosition: titleAttachmentPosition}"/>
            </f:else>
        </f:if>

    </f:section>

    <f:section name="PageTreeTable">

        <table class="table">
            <thead>
                <tr>
                    <th>
                        <f:translate key="tx_mindshapeseo_label.preview.page"/>
                    </th>
                    <th>
                        <f:translate key="tx_mindshapeseo_label.preview"/>
                    </th>
                    <th>
                        <f:translate key="tx_mindshapeseo_label.metadata"/>
                    </th>
                </tr>
            </thead>
            <tbody>
                <f:for each="{pageTree}" as="page" iteration="iterator">
                    <tr class="page{f:if(condition: page.row.uid, else: ' root')}">
                        <td class="pagetree-info" width="25%">
                            <span class="depth-markup{f:if(condition: iterator.isFirst, then: ' rootpage')}{f:if(condition: page.hasSub, then: ' subpages')}">
                                {page.depthData -> f:format.raw()}
                                <f:format.raw>{page.HTML}</f:format.raw>
                                <span class="title">{page.row.title}</span>
                            </span>
                        </td>
                        <td width="50%">
                            <f:if condition="{page.row}">
                                <f:render partial="GoogleSearchPreview" section="Main" arguments="{
                                    titleAttachment: titleAttachment,
                                    titleAttachmentSeperator: titleAttachmentSeperator,
                                    titleAttachmentPosition: titleAttachmentPosition,
                                    title: page.metadata.title,
                                    url: page.metadata.url,
                                    previewUrl: page.metadata.previewUrl,
                                    description: page.metadata.meta.description
                                    focusKeyword: page.metadata.meta.focusKeyword
                                    pageUid: page.metadata.uid
                                    editing: 1
                                }"/>
                            </f:if>
                        </td>
                        <td width="25%">
                            <div class="focus-keyword">
                                <label>
                                    <f:translate key="tx_mindshapeseo_label.preview.focus_keyword"/>
                                </label>
                                <f:if condition="{page.metadata.meta.focusKeyword}">
                                    <f:then>
                                        {page.metadata.meta.focusKeyword}
                                    </f:then>
                                    <f:else>
                                    <span class="focus-keyword-na">
                                        <f:translate key="tx_mindshapeseo_label.preview.focus_keyword.not_available"/>
                                    </span>
                                    </f:else>
                                </f:if>
                            </div>
                            <div class="robots">
                                <label>
                                    <f:translate key="tx_mindshapeseo_label.robots"/>:
                                </label>
                                <f:if condition="{page.metadata.meta.robots.noindexInherited}">
                                    <f:then>
                                        <dfn class="msh-tooltip" title="{f:translate(key: 'tx_mindshapeseo_label.inherited_from_page')}: {page.metadata.meta.robots.noindexInherited}">
                                            <f:translate key="tx_mindshapeseo_domain_model_pages.mindshapeseo_no_index_inherited"/>,
                                        </dfn>
                                    </f:then>
                                    <f:else>
                                        <f:if condition="{page.metadata.meta.robots.noindex}">
                                            <f:then>
                                                <f:translate key="tx_mindshapeseo_domain_model_pages.mindshapeseo_no_index"/>,
                                            </f:then>
                                            <f:else>
                                                <f:translate key="tx_mindshapeseo_domain_model_pages.mindshapeseo_index"/>,
                                            </f:else>
                                        </f:if>
                                    </f:else>
                                </f:if>
                                <f:if condition="{page.metadata.meta.robots.noindexInherited}">
                                    <f:then>
                                        <dfn class="msh-tooltip" title="{f:translate(key: 'tx_mindshapeseo_label.inherited_from_page')}: {page.metadata.meta.robots.nofollowInherited}">
                                            <f:translate key="tx_mindshapeseo_domain_model_pages.mindshapeseo_no_follow_inherited"/>,
                                        </dfn>
                                    </f:then>
                                    <f:else>
                                        <f:if condition="{page.metadata.meta.robots.noindex}">
                                            <f:then>
                                                <f:translate key="tx_mindshapeseo_domain_model_pages.mindshapeseo_no_follow"/>
                                            </f:then>
                                            <f:else>
                                                <f:translate key="tx_mindshapeseo_domain_model_pages.mindshapeseo_follow"/>
                                            </f:else>
                                        </f:if>
                                    </f:else>
                                </f:if>
                            </div>
                            <div class="canonical">
                                <f:if condition="{page.metadata.canonicalUrl}">
                                    <label>
                                        <f:translate key="tx_mindshapeseo_domain_model_pages.mindshapeseo_canonical"/>:
                                    </label>
                                    {page.metadata.canonicalUrl}
                                </f:if>
                            </div>
                        </td>
                    </tr>
                </f:for>
            </tbody>
        </table>

    </f:section>

</html>
