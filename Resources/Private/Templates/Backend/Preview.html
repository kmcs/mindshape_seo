<html data-namespace-typo3-fluid="true" lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://typo3.org/ns/fluid/ViewHelpers">

    <f:layout name="Backend"/>

    <f:section name="Main">

        <f:if condition="{noPageSelected}">
            <f:then>
                <f:translate key="tx_minshapeseo_label.preview.no_page_selected"/>
            </f:then>
            <f:else>
                <f:render section="Preview" arguments="{_all}"/>
            </f:else>
        </f:if>

    </f:section>

    <f:section name="Preview">

        <h1>
            <f:translate key="tx_minshapeseo_label.seo_preview_for_page"/>
            {currentPageMetaData.title}
        </h1>

        <div class="row">
            <div class="col-sm-2">
                <f:form id="depthselect-form" action="preview" controller="Backend">
                    <div class="form-group">
                        <label>
                            <f:translate key="tx_minshapeseo_label.preview.levels"/>
                        </label>
                        <f:form.select id="depthselect" name="depth" options="{levelOptions}" value="{depth}" class="form-control"/>
                    </div>
                </f:form>
            </div>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>
                        <f:translate key="tx_minshapeseo_label.preview.page"/>
                    </th>
                    <th>
                        <f:translate key="tx_minshapeseo_label.preview"/>
                    </th>
                    <th>
                        <f:translate key="tx_minshapeseo_label.metadata"/>
                    </th>
                </tr>
            </thead>
            <tbody>
                <f:for each="{pageTree}" as="page" iteration="iterator">
                    <tr class="page{f:if(condition: page.row.uid, else: ' root')}">
                        <td class="pagetree-info" width="25%">
                            <span class="depth-markup{f:if(condition: iterator.isFirst, then: ' rootpage')}{f:if(condition: page.hasSub, then: ' subpages')}">
                                {page.depthData -> f:format.raw()}
                                <f:format.raw>{page.HTML}</f:format.raw>
                                <span class="title">{page.row.title}</span>
                            </span>
                        </td>
                        <td width="50%">
                            <f:if condition="{page.row}">
                                <f:render partial="GoogleSearchPreview" arguments="{
                                    titleAttachment: page.metadata.titleAttachment,
                                    titleAttachmentSeperator: page.metadata.titleAttachmentSeperator,
                                    title: page.metadata.title,
                                    url: page.metadata.url,
                                    previewUrl: page.metadata.previewUrl,
                                    description: page.metadata.meta.description
                                    pageUid: page.metadata.uid
                                }"/>
                            </f:if>
                        </td>
                        <td width="25%">
                            <f:if condition="{page.row}">
                                <div class="form-group">
                                    <div class="checkbox">
                                        <label>
                                            <f:form.checkbox name="noindex" value="1" checked="{page.meta.robots.noindex}"/>
                                            <f:translate key="tx_minshapeseo_domain_model_pages.mindshapeseo_no_index"/>
                                        </label>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <f:form.checkbox name="nofollow" value="1" checked="{page.meta.robots.nofollow}"/>
                                            <f:translate key="tx_minshapeseo_domain_model_pages.mindshapeseo_no_follow"/>
                                        </label>
                                    </div>
                                </div>
                            </f:if>
                        </td>
                    </tr>
                </f:for>
            </tbody>
        </table>

    </f:section>

</html>
